@model HomeController.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12 d-flex justify-content-between align-items-center">
            <h3 class="ft-manage-title">Dashboard</h3>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card p-3 bg-transparent" style="border:1px solid rgba(255,215,0,0.12);">
                <div class="card-body">
                    <small class="text-muted">Saldo Total</small>
                    <h4 class="mt-2" style="color:#ffd700">@Model.TotalSaldo.ToString("C")</h4>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card p-3 bg-transparent" style="border:1px solid rgba(255,215,0,0.12);">
                <div class="card-body">
                    <small class="text-muted">Receitas (mês)</small>
                    <h4 class="mt-2">@Model.ReceitasMes.ToString("C")</h4>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card p-3 bg-transparent" style="border:1px solid rgba(255,215,0,0.12);">
                <div class="card-body">
                    <small class="text-muted">Despesas (mês)</small>
                    <h4 class="mt-2">@Model.DespesasMes.ToString("C")</h4>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card p-3 bg-transparent" style="border:1px solid rgba(255,215,0,0.12);">
                <div class="card-body">
                    <small class="text-muted">Metas Atingidas</small>
                    <h4 class="mt-2">@Model.MetasAtingidas</h4>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-lg-8">
            <div class="card p-3 bg-transparent" style="border:1px solid rgba(255,215,0,0.12);">
                <div class="card-body">
                    <h5 class="card-title">Movimento Mensal</h5>
                    <canvas id="chartMonthly" height="140"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card p-3 bg-transparent" style="border:1px solid rgba(255,215,0,0.12);">
                <div class="card-body">
                    <h5 class="card-title">Por Categoria (ano)</h5>
                    <canvas id="chartCategory" height="240"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-lg-6">
            <div class="card p-3 bg-transparent" style="border:1px solid rgba(255,215,0,0.12);">
                <div class="card-body">
                    <h5 class="card-title">Últimas Transações</h5>
                    <div class="table-responsive">
                        <table class="table table-borderless text-white mb-0">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Categoria</th>
                                    <th class="text-end">Valor</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var t in Model.UltimasTransacoes)
                                {
                                    var dt = (DateTime)t.GetType().GetProperty("Data").GetValue(t);
                                    var valor = (decimal)t.GetType().GetProperty("Valor").GetValue(t);
                                    var categoria = (string)t.GetType().GetProperty("Categoria").GetValue(t);
                                    <tr>
                                        <td>@dt.ToString("dd/MM/yyyy")</td>
                                        <td>@categoria</td>
                                        <td class="text-end">@valor.ToString("C")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card p-3 bg-transparent" style="border:1px solid rgba(255,215,0,0.12);">
                <div class="card-body">
                    <h5 class="card-title">Resumo rápido</h5>
                    <ul class="list-unstyled mb-0">
                        <li>Contas: <strong>@(Model.TotalSaldo != 0 ? "Ativo" : "Sem contas")</strong></li>
                        <li>Receitas mês: <strong>@Model.ReceitasMes.ToString("C")</strong></li>
                        <li>Despesas mês: <strong>@Model.DespesasMes.ToString("C")</strong></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const monthlyLabels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.MensalLabels));
        const monthlyData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.MensalValues));
        const categoryLabels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.CategoriaLabels));
        const categoryData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.CategoriaValues));

        const ctxM = document.getElementById('chartMonthly').getContext('2d');
        new Chart(ctxM, {
            type: 'bar',
            data: {
                labels: monthlyLabels,
                datasets: [{
                    label: 'Movimento (R$)',
                    data: monthlyData,
                    borderWidth: 1,
                    backgroundColor: 'rgba(255,215,0,0.9)'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        const ctxC = document.getElementById('chartCategory').getContext('2d');
        new Chart(ctxC, {
            type: 'pie',
            data: {
                labels: categoryLabels,
                datasets: [{
                    data: categoryData,
                    backgroundColor: [
                        '#ffd700','#f9c500','#e6c200','#d1a100','#c09000','#b07a00','#a05f00','#8a4700'
                    ]
                }]
            },
            options: {
                responsive: true,
            }
        });
    </script>
}

<style>
    .ft-card {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        backdrop-filter: blur(12px);
    }

    .ft-main-content {
        background: #1e1e1e !important;
        padding: 40px !important;
        min-height: 100vh;
    }

    .ft-page-container {
        max-width: 1100px;
        margin: 0 auto;
    }
</style>