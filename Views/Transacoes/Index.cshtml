@model IEnumerable<FinTrack.Models.Transacao>
@{
    ViewData["Title"] = "Transações";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="ft-main-content">
    <div class="ft-page-container">

        <div class="mb-4">
            <h1 class="fw-bold text-white" style="font-size: 2rem;">Transações</h1>
            <p class="text-secondary" style="margin-top: -6px;">Visualize, filtre e gerencie suas transações.</p>
        </div>

        <div class="ft-card p-4 mb-4">
            <form method="get">

                <div class="row g-3">

                    <div class="col-md-3">
                        <label class="form-label text-white-50">Data Início</label>
                        <input type="date" name="dataInicio" class="form-control"
                               value="@Context.Request.Query["dataInicio"]" />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-white-50">Data Fim</label>
                        <input type="date" name="dataFim" class="form-control"
                               value="@Context.Request.Query["dataFim"]" />
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-white-50">Categoria</label>
                        <select name="categoriaId" class="form-select">
                            <option value="">Todas</option>

                            @{
                                var categoriaAtual = Context.Request.Query["categoriaId"].ToString();
                                foreach (var item in (SelectList)ViewBag.Categorias)
                                {
                                    var marcado = item.Value == categoriaAtual ? " selected" : "";
                                    @Html.Raw($"<option value='{item.Value}'{marcado}>{item.Text}</option>")
                                    ;
                                }
                            }
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-white-50">Conta</label>
                        <select name="contaId" class="form-select">
                            <option value="">Todas</option>

                            @{
                                var contaAtual = Context.Request.Query["contaId"].ToString();
                                foreach (var item in (SelectList)ViewBag.Contas)
                                {
                                    var marcado = item.Value == contaAtual ? " selected" : "";
                                    @Html.Raw($"<option value='{item.Value}'{marcado}>{item.Text}</option>")
                                    ;
                                }
                            }
                        </select>
                    </div>

                </div>

                <div class="row g-3 mt-3">

                    <div class="col-md-3">
                        <label class="form-label text-white-50">Tipo Pagamento</label>
                        <select name="tipoPagamentoId" class="form-select">
                            <option value="">Todos</option>

                            @{
                                var pagamentoAtual = Context.Request.Query["tipoPagamentoId"].ToString();
                                foreach (var item in (SelectList)ViewBag.TiposPagamento)
                                {
                                    var marcado = item.Value == pagamentoAtual ? " selected" : "";
                                    @Html.Raw($"<option value='{item.Value}'{marcado}>{item.Text}</option>")
                                    ;
                                }
                            }
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label text-white-50">Tipo</label>
                        @{
                            var tipoAtual = Context.Request.Query["tipo"].ToString();
                        }
                        <select name="tipo" class="form-select">
                            <option value="">Todos</option>
                            @Html.Raw($"<option value='Entrada'{(tipoAtual == "Entrada" ? " selected" : "")}>Entrada</option>");
                            @Html.Raw($"<option value='Saída'{(tipoAtual == "Saída" ? " selected" : "")}>Saída</option>");
                        </select>
                    </div>

                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit"
                                class="btn fw-bold w-100"
                                style="background: #ffd700; color: #000; border-radius: 10px;">
                            Filtrar
                        </button>
                    </div>

                    <div class="col-md-3 d-flex align-items-end">
                        <a href="/Transacoes/Create"
                           class="btn fw-bold w-100"
                           style="background: #ffd700; color: #000; border-radius: 10px;">
                            + Nova Transação
                        </a>
                    </div>

                </div>
            </form>
        </div>

        <div class="ft-card p-3">

            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-white-50">Listagem de Transações</span>
                <span class="text-white-50">Total: <strong>@Model.Count()</strong></span>
            </div>

            <table class="table table-dark table-hover align-middle"
                   style="background: rgba(255,255,255,0.03); border-radius: 12px; overflow: hidden;">
                <thead>
                    <tr class="text-warning">
                        <th>Data</th>
                        <th>Categoria</th>
                        <th>Conta</th>
                        <th>Pagamento</th>
                        <th>Tipo</th>
                        <th>Valor</th>
                        <th class="text-center">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    @if (!Model.Any())
                    {
                        <tr>
                            <td colspan="7" class="text-center text-secondary py-4">
                                Nenhuma transação encontrada.
                            </td>
                        </tr>
                    }
                    else
                    {
                        foreach (var t in Model)
                        {
                            <tr>
                                <td>@t.Data.ToString("dd/MM/yyyy")</td>
                                <td>@t.Categoria.Nome</td>
                                <td>@t.Conta.Nome</td>
                                <td>@t.TipoPagamento.Nome</td>
                                <td>@t.Tipo</td>
                                <td class="fw-bold @(t.Tipo == Transacao.TipoTransacao.Entrada ? "text-success" : "text-danger")">
                                    @t.Valor.ToString("C")
                                </td>
                                <td class="text-center">
                                    <a class="btn btn-sm btn-secondary" href="/Transacoes/Details/@t.Id">Ver</a>
                                    <a class="btn btn-sm btn-primary" href="/Transacoes/Edit/@t.Id">Editar</a>
                                    <a class="btn btn-sm btn-danger" href="/Transacoes/Delete/@t.Id">Excluir</a>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

    </div>
</div>

<style>
    .ft-card {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        backdrop-filter: blur(12px);
    }

    .ft-main-content {
        background: #1e1e1e !important;
        padding: 40px !important;
        min-height: 100vh;
    }

    .ft-page-container {
        max-width: 1100px;
        margin: 0 auto;
    }
</style>
